repos:
  - repo: local
    hooks:
      - id: sops-encrypt
        name: SOPS Auto-Encryption
        entry: bash -c '
          failed=0;
          for file in "$@"; do
            if grep -qE "^(data|stringData):" "$file" && ! grep -q "^sops:" "$file"; then
              sops --encrypt --in-place "$file";
              echo "üîê Encrypted $file";
              failed=1;
            fi;
          done;
          if [ $failed -eq 1 ]; then
            echo "‚ö†Ô∏è  Files were encrypted. Please run \"git add\" on them and commit again.";
            exit 1;
          fi' --
        language: system
        files: .+\.sops\.yaml$
